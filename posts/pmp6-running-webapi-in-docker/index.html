<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="PMP Update 6: Creating and running the Web API container" /><meta property="og:locale" content="en" /><meta name="description" content="Setup" /><meta property="og:description" content="Setup" /><link rel="canonical" href="https://httpete.nz/posts/pmp6-running-webapi-in-docker/" /><meta property="og:url" content="https://httpete.nz/posts/pmp6-running-webapi-in-docker/" /><meta property="og:site_name" content="httpete.nz" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-01-08T10:58:00+13:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="PMP Update 6: Creating and running the Web API container" /><meta name="twitter:site" content="@nz_pete" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-01-18T17:53:56+13:00","datePublished":"2024-01-08T10:58:00+13:00","description":"Setup","headline":"PMP Update 6: Creating and running the Web API container","mainEntityOfPage":{"@type":"WebPage","@id":"https://httpete.nz/posts/pmp6-running-webapi-in-docker/"},"url":"https://httpete.nz/posts/pmp6-running-webapi-in-docker/"}</script><title>PMP Update 6: Creating and running the Web API container | httpete.nz</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="httpete.nz"><meta name="application-name" content="httpete.nz"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/pete.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">httpete.nz</a></div><div class="site-subtitle font-italic">Pete Russell</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/projects/" class="nav-link"> <i class="fa-fw fas fa-code ml-xl-3 mr-xl-3 unloaded"></i> <span>PROJECTS</span> </a><li class="nav-item"> <a href="/contact/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>CONTACT</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/peterussell" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/nz_pete" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['pete.russell01','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>PMP Update 6: Creating and running the Web API container</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>PMP Update 6: Creating and running the Web API container</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> Pete Russell </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, Jan 8, 2024, 10:58 AM +1300" >Jan 8<i class="unloaded">2024-01-08T10:58:00+13:00</i> </span></div><div> <span> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jan 17, 2024, 10:53 PM -0600" >Jan 17<i class="unloaded">2024-01-18T17:53:56+13:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1410 words">7 min read</span></div></div><div class="post-content"><h2 id="setup">Setup</h2><ul><li>Docker Desktop<li>Windows 10 Home<li>Visual Studio</ul><h2 id="web-api-project-setup-and-layout">Web API Project setup and layout</h2><p>I wanted to try implementing the API following the <a href="https://github.com/jasontaylordev/CleanArchitecture">Clean Architecture</a> approach, and using a repository pattern outlined <a href="https://www.youtube.com/watch?v=kwehxBDX_o8&amp;t=111s">here</a> (as an aside, I’ve found Milan Jovanović’s videos &amp; newsletters full of great content, no affiliation).</p><p>So far the <code class="language-plaintext highlighter-rouge">API</code>, <code class="language-plaintext highlighter-rouge">Domain</code>, and <code class="language-plaintext highlighter-rouge">Persistence</code> projects have been implemented for the purpose of getting the container running, and returning a list of basic ‘Flight’ objects at the endpoint <code class="language-plaintext highlighter-rouge">/v1/flights</code>. The <code class="language-plaintext highlighter-rouge">Domain</code> and <code class="language-plaintext highlighter-rouge">Persistence</code> projects are Class Library (DLL) projects, and <code class="language-plaintext highlighter-rouge">API</code> is a Web API project. <code class="language-plaintext highlighter-rouge">API</code> is what actually gets invoked in the container, and references the other two.</p><p>As an example, here’s a simple (hard-coded) “flight” created to test the API, at <code class="language-plaintext highlighter-rouge">GET /v1/flights</code>:</p><p><img data-proofer-ignore data-src="/assets/img/posts/2024-01-07/get-flights.png" alt="Get flights" /></p><h3 id="creating-the-api-project">Creating the API project</h3><ol><li>In Visual Studio &gt; New Project &gt; ASP.NET Core Web API. Click Next.<li>Fill out a name and location. Click Next.<li>Choose a framework (I went with .NET 8.0 just to try out the latest &amp; greatest); <em>disable</em> Configure for HTTPS (we’ll worry about HTTPS termination outside of the container); <em>enable</em> Enable Docker. Click Create.</ol><p>I followed similar steps to create the <code class="language-plaintext highlighter-rouge">Domain</code> and <code class="language-plaintext highlighter-rouge">Persistence</code> projects, but choosing Class Library as the output type (this will be relevant when looking at the <code class="language-plaintext highlighter-rouge">Dockerfile</code> steps).</p><h2 id="dockerfile">Dockerfile</h2><p>This is where I landed with the Dockerfile (steps explained below, full file at the end):</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /app
</pre></table></code></div></div><p>Pull down the dotnet SDK image, and set the <code class="language-plaintext highlighter-rouge">WORKDIR</code> to <code class="language-plaintext highlighter-rouge">/app</code>. The workdir is the location <em>in the image</em> that subsequent commands are run from.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>COPY ["api/API.csproj", "api/"]
COPY ["Domain/Domain.csproj", "Domain/"]
COPY ["Persistence/Persistence.csproj", "Peristence/"]
RUN dotnet restore "api/API.csproj"
RUN dotnet restore "Domain/Domain.csproj"
RUN dotnet restore "Peristence/Persistence.csproj"
</pre></table></code></div></div><p>Copy the three <code class="language-plaintext highlighter-rouge">.csproj</code> files and run the <code class="language-plaintext highlighter-rouge">dotnet restore</code> command for each. The reason for copy just the <code class="language-plaintext highlighter-rouge">.csproj</code> files (rather than the all the files, which we’ll do later) is related to <a href="https://docs.docker.com/build/guide/layers/">layers</a> in Docker. Each step is cached, so that means if one of the restore steps fails, we haven’t wasted a bunch of time copying all of the files over. However, if these restore steps pass then this gets cached. Essentially this means if a step later on fails, Docker’s smart enough to say “hey - all those copy <code class="language-plaintext highlighter-rouge">.csproj</code> and <code class="language-plaintext highlighter-rouge">dotnet restore</code> steps passed, we don’t need to do that again”.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>COPY . .
RUN dotnet publish "api/API.csproj" -c Release -o out
</pre></table></code></div></div><p>Copy the rest of the files over and publish the build to a directory called <code class="language-plaintext highlighter-rouge">out</code>.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS runtime
WORKDIR /app
COPY --from=build /app/out ./
</pre></table></code></div></div><p>Cool, now we’re done with the build, we want to set up the container image that we actually want to use for running the app, in this case <code class="language-plaintext highlighter-rouge">dotnet/aspnet:8.0</code>. This is a stripped down container that doesn’t contain the build tools we used above – just an environment for running the app (and not much more, not evening <code class="language-plaintext highlighter-rouge">ping</code>, <code class="language-plaintext highlighter-rouge">curl</code>, etc). Then switch into the <code class="language-plaintext highlighter-rouge">/app</code> workdir (same as above), and copy the output from the build we just did.</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>ENV ASPNETCORE_URLS=http://+:8080
EXPOSE 8080
ENTRYPOINT ["dotnet", "API.dll"]
</pre></table></code></div></div><p>Finally, <code class="language-plaintext highlighter-rouge">ASPNETCORE_URLS</code> <a href="https://learn.microsoft.com/en-us/aspnet/core/fundamentals/host/web-host?view=aspnetcore-8.0">tells dotnet to run on port 8080</a>, which <code class="language-plaintext highlighter-rouge">EXPOSE</code> makes available from the container to the outside world. The last thing is to tell docker what to run when the container starts up, which is given by the <code class="language-plaintext highlighter-rouge">ENTRYPOINT</code> command.</p><h3 id="full-dockerfile">Full <code class="language-plaintext highlighter-rouge">Dockerfile</code></h3><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre>FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build
WORKDIR /app

COPY ["api/API.csproj", "api/"]
COPY ["Domain/Domain.csproj", "Domain/"]
COPY ["Persistence/Persistence.csproj", "Peristence/"]
RUN dotnet restore "api/API.csproj"
RUN dotnet restore "Domain/Domain.csproj"
RUN dotnet restore "Peristence/Persistence.csproj"

COPY . .
RUN dotnet publish "api/API.csproj" -c Release -o out

FROM mcr.microsoft.com/dotnet/aspnet:8.0 AS runtime
WORKDIR /app
COPY --from=build /app/out ./

ENV ASPNETCORE_URLS=http://+:8080
EXPOSE 8080
ENTRYPOINT ["dotnet", "API.dll"]

</pre></table></code></div></div><h2 id="building-the-image">Building the image</h2><p>Now we need to build the image, and then run the container so we can access the app.</p><p>One of the important parts here that I got a little stumped on, is that we need to run <code class="language-plaintext highlighter-rouge">docker build</code> from within the <code class="language-plaintext highlighter-rouge">API</code> project, because that’s where the Dockerfile is. However, because we have references to projects up one level, we need to set the directory for the command to be up a level, ie. <code class="language-plaintext highlighter-rouge">../</code>.</p><p>The project structure looks like this:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>src
|- API
   |- Dockerfile
|- Domain
|- Persistence
</pre></table></code></div></div><p>So, to build the image (assuming <a href="https://docs.docker.com/desktop/install/windows-install/">Docker’s installed</a>), we can run:</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker build -t api -f Dockerfile ../
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">-t api</code> - tags the image as “api”<li><code class="language-plaintext highlighter-rouge">-f Dockerfile</code> - tells <code class="language-plaintext highlighter-rouge">docker build</code> to use the Dockerfile specified at this path (in this case the current API directory)<li><code class="language-plaintext highlighter-rouge">../</code> - run the command from a directory up</ul><p>If the build succeeds, run <code class="language-plaintext highlighter-rouge">docker images</code> in the terminal to see the newly created image.</p><h2 id="running-the-container">Running the container</h2><p>In a terminal, run this to start the container (assuming the container’s named <code class="language-plaintext highlighter-rouge">api</code> as above)</p><div lang="plaintext" class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>docker run -p 8080:8080 api
</pre></table></code></div></div><ul><li><code class="language-plaintext highlighter-rouge">-p 8080:8080</code> - forwards port 8080 on the <em>host</em>, to port 8080 in the <em>container</em> (which we configured above in our Dockerfile). This lets you browse to <code class="language-plaintext highlighter-rouge">http://localhost:8080</code> and hit the API running in the container. As an example, if you wanted to browse to <code class="language-plaintext highlighter-rouge">http://localhost:9999</code> on your machine (ie. the host), but still running the application on port 8080 inside the container, you could instead specify <code class="language-plaintext highlighter-rouge">-p 9999:8080</code>.</ul><p><strong>IMPORTANT</strong> (AKA a wee mistake that took me too long to figure out) the port mapping needs to come <em>before</em> the name of the image. Otherwise, although no errors are shown, you won’t be able to connect to the container.</p><p>If all this works, you should now be able to browse to <code class="language-plaintext highlighter-rouge">http://localhost:8080/{your-api-path}</code> and see your containerized API :)</p><h2 id="swagger">Swagger</h2><p>A cool feature baked in to Web API is support for OpenAPI documentation with <a href="https://swagger.io/">Swagger</a>, which gives automatic documentation of the API.</p><p>By default this only enabled for development builds, which means it isn’t available on the container we just built above, however if you a) run the app in the container in dev mode b) change the swagger settings in <code class="language-plaintext highlighter-rouge">Program.cs</code>, or c) run the application directly from Visual Studio (see “Running with IISExpress” below), then Swagger documentation will be available at <code class="language-plaintext highlighter-rouge">&lt;your-app-url&gt;/swagger/v1/swagger.json</code>:</p><p><img data-proofer-ignore data-src="/assets/img/posts/2024-01-07/openapi-swagger.png" alt="Swagger documentation" /></p><h2 id="troubleshooting">Troubleshooting</h2><h3 id="running-from-visual-studio">Running from Visual Studio</h3><p>If you chose “Enable Docker” when creating the project, by default Visual Studio will run the application in a Docker container in VS when you hit Run/F5. This is pretty cool, but you might want to troubleshoot without the intermediate layer of the container.</p><p>To do this, look for the “Docker” run configuration dropdown in the top toolbar, next to the “Solution Configurations” and “Solution Platforms” dropdowns (usually say “Debug” “Any CPU” by default).</p><p>Click the dropdown displaying Docker, and change the setting to IISExpress. Run the project, which should now be running on the default IISExpress ports (see API &gt; Properties &gt; <code class="language-plaintext highlighter-rouge">launchSettings.json</code>).</p><p><img data-proofer-ignore data-src="/assets/img/posts/2024-01-07/change-host-to-iisexpress.png" alt="Running with IISExpress" /></p><h3 id="viewing-container-information">Viewing container information</h3><p>Docker Desktop has come a long way since the last time I used it. It gives a great overview of container info including logs, stats, output from <code class="language-plaintext highlighter-rouge">docker inspect</code> organized by category (eg. network config), bind mounts, and a terminal (Exec) into the container.</p><p>I found this particularly useful trying to troubleshoot port mapping, when I noticed the port wasn’t shown as mapped in the Docker Desktop UI.</p><p>If you prefer to use the CLI, these commands may be useful:</p><ul><li><code class="language-plaintext highlighter-rouge">docker images</code> - view all docker images (and hashes)<li><code class="language-plaintext highlighter-rouge">docker ps</code> - view all running containers<li><code class="language-plaintext highlighter-rouge">docker inspect &lt;hash&gt;</code> - view configuration information for a container<li><code class="language-plaintext highlighter-rouge">docker image rm &lt;hash&gt;</code> - remove a container image (might need <code class="language-plaintext highlighter-rouge">--force</code>)</ul><h3 id="cant-reach-the-application-via-on-localhost">Can’t reach the application via on localhost</h3><p>Things to check:</p><ul><li>Are you running the Web API application on the correct port? (<code class="language-plaintext highlighter-rouge">ASPNETCORE_URLS</code> environment variable, see above)<li>Has the port been exposed by the container to the outside world? (<code class="language-plaintext highlighter-rouge">EXPOSE</code> in Dockerfile, see above)<li>Did you specify <code class="language-plaintext highlighter-rouge">-p &lt;host-port&gt;:&lt;container-port&gt;</code> when you called <code class="language-plaintext highlighter-rouge">docker run</code>? (eg. <code class="language-plaintext highlighter-rouge">docker run -p 8080:8080 api</code>)<ul><li>Did the port come <em>before</em> the container image name?</ul></ul><h2 id="next-steps">Next steps</h2><p>I hope that’s helpful for someone who’s trying to achieve the same, and avoid running into a few of the issues that stumped me.</p><p>Now that’s running, the next goal is to get the React/Next web application running and containerize that, ready to get them both running with Kubernetes.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/projects/'>projects</a>, <a href='/categories/pmp/'>pmp</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/c/" class="post-tag no-text-decoration" >c#</a> <a href="/tags/webapi/" class="post-tag no-text-decoration" >webapi</a> <a href="/tags/docker/" class="post-tag no-text-decoration" >docker</a> <a href="/tags/pmp/" class="post-tag no-text-decoration" >pmp</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=PMP Update 6: Creating and running the Web API container - httpete.nz&url=https://httpete.nz/posts/pmp6-running-webapi-in-docker/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=PMP Update 6: Creating and running the Web API container - httpete.nz&u=https://httpete.nz/posts/pmp6-running-webapi-in-docker/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=PMP Update 6: Creating and running the Web API container - httpete.nz&url=https://httpete.nz/posts/pmp6-running-webapi-in-docker/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink('', 'Link copied successfully!')" data-toggle="tooltip" data-placement="top" title="Copy link"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/pmp8-porting-the-fetcher/">PMP Update 8: Porting the fetcher</a><li><a href="/posts/pmp7-web-project-setup-with-nextjs-and-docker/">PMP Update 7: Web project setup with Next.js and Docker</a><li><a href="/posts/pmp6-running-webapi-in-docker/">PMP Update 6: Creating and running the Web API container</a><li><a href="/posts/pmp5-architecture-use-case-life-update/">PMP Update 5: Architecture, use case, life update</a><li><a href="/posts/map-project-docker-container/">PMP Update 2: Java+Docker</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pmp/">pmp</a> <a class="post-tag" href="/tags/c/">c#</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/aviation/">aviation</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/big-o-notation/">big-o-notation</a> <a class="post-tag" href="/tags/cs-study/">cs-study</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/projects/">projects</a> <a class="post-tag" href="/tags/azure/">azure</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/pmp5-architecture-use-case-life-update/"><div class="card-body"> <span class="timeago small" >Dec 21, 2023<i class="unloaded">2023-12-21T21:17:00+13:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PMP Update 5: Architecture, use case, life update</h3><div class="text-muted small"><p> Life update After a short 1 year, 3 months, and 29 day process, my green card has been issued. It’s been a whirlwind since. We packed up life in Christchurch, moved to the Chicago North Shore and...</p></div></div></a></div><div class="card"> <a href="/posts/pmp7-web-project-setup-with-nextjs-and-docker/"><div class="card-body"> <span class="timeago small" >Jan 18<i class="unloaded">2024-01-18T11:53:00+13:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PMP Update 7: Web project setup with Next.js and Docker</h3><div class="text-muted small"><p> Preamble Now we have the web API running in Docker, the next job is to set up a project for the frontend and get that running in a container as well. I decided on React given it’s the frontend la...</p></div></div></a></div><div class="card"> <a href="/posts/pmp8-porting-the-fetcher/"><div class="card-body"> <span class="timeago small" >Feb 1<i class="unloaded">2024-02-01T11:25:00+13:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>PMP Update 8: Porting the fetcher</h3><div class="text-muted small"><p> The original plan for this update was to get the API and web containers talking to each other but we’re going to change tack and try to get ‘The Fetcher’ up and running. To recap, the idea for thi...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/setting-up-minikube-on-windows/" class="btn btn-outline-primary" prompt="Older"><p>Setting up Minikube on Windows</p></a> <a href="/posts/pmp7-web-project-setup-with-nextjs-and-docker/" class="btn btn-outline-primary" prompt="Newer"><p>PMP Update 7: Web project setup with Next.js and Docker</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/nz_pete">Pete Russell</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/pmp/">pmp</a> <a class="post-tag" href="/tags/c/">c#</a> <a class="post-tag" href="/tags/docker/">docker</a> <a class="post-tag" href="/tags/aviation/">aviation</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/big-o-notation/">big o notation</a> <a class="post-tag" href="/tags/cs-study/">cs study</a> <a class="post-tag" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag" href="/tags/projects/">projects</a> <a class="post-tag" href="/tags/azure/">azure</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://httpete.nz{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=27195873"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', '27195873'); }); </script>
